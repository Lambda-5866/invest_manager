<!DOCTYPE html>
<html>
<head>
    <title>대시보드</title>
</head>
<body>
<h1>자산 대시보드</h1>
<ul id="asset-list"></ul>
<button onclick="openModal()">자산 추가</button>

<div id="asset-modal" style="display:none;">
  <h3>자산 추가</h3>
  <form id="asset-form">
    <input name="name" placeholder="자산 이름" required><br>
    <input name="asset_type" placeholder="자산 타입" required><br>
    <input name="amount" placeholder="수량" type="number" required><br>
    <input name="buy_price" placeholder="매입가" type="number" step="0.01" required><br>
    <button type="submit">추가</button>
    <button type="button" onclick="closeModal()">취소</button>
  </form>
</div>

<script>
async function loadAssets() {
  const response = await fetch('/api/assets/');
  const data = await response.json();
  const list = document.getElementById('asset-list');
  list.innerHTML = "";
  data.forEach(asset => {
    const li = document.createElement("li");
    li.id = `asset-${asset.id}`;
    li.innerHTML = `${asset.name} (${asset.asset_type}) - ${asset.amount} @ ${asset.buy_price}
      <button onclick="deleteAsset(${asset.id})">삭제</button>`;
    list.appendChild(li);
  });
}

function openModal() { document.getElementById('asset-modal').style.display='block'; }
function closeModal() { document.getElementById('asset-modal').style.display='none'; }

document.getElementById('asset-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData.entries());
  await fetch('/api/assets/add/', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(data)
  });
  closeModal();
  loadAssets();
});

async function deleteAsset(id) {
  await fetch(`/api/assets/${id}/delete/`, { method: 'DELETE' });
  document.getElementById(`asset-${id}`).remove();
}

loadAssets();
</script>
</body>
</html>
